require(["config"],function(){require(["jquery","header","footer","template","cookie"],function(u,c,t,o,e){new Promise(function(t,e){u("header").load("/html/component/header.html",function(){t()}),u("footer").load("/html/component/footer.html")}).then(function(){c.nav(),c.shouye(),c.cookie(),c.logout(),c.shownum()}).then(function(){u.cookie("product")?u("#no-pro").css({display:"none"}):u("#no-pro").css({display:"block"});var t=u.cookie("product");t=JSON.parse(t);var e=o("cart-template",{product:t});function i(){for(var t=u(".single-check"),e=0,o=0;o<t.length;o++)u(t[o]).prop("checked")&&(e+=parseInt(u(t[o]).parent().siblings(".tr-count").text().slice(1)));u(".amount").text("￥"+e)}function p(){for(var t=u(".single-check"),e=0,o=0;o<t.length;o++)u(t[o]).prop("checked")&&(e+=parseInt(u(t[o]).parents(".product-info").find(".cart-input").val()));u(".pro_sum").text(e)}u("#product-tr").html(e),u(".product-tr").on("click",".delete-btn",function(t){var e=u.cookie("product");e=JSON.parse(e);var o=u(this).parent().parent(),n=o.next(".pro-id").text(),r=e.filter(function(t){return!(n==t.id)});0==r.length?(u("#no-pro").css({display:"block"}),r=JSON.stringify(r),u.cookie("product",r,{path:"/",expires:-1})):(r=JSON.stringify(r),u.cookie("product",r,{path:"/",expires:10})),o.remove(),i(),p(),c.shownum()}),u(".product-tr").on("click",".add,.sub",function(t){var e=u.cookie("product");e=JSON.parse(e);var o=u(this).parents(".product-info").next(".pro-id").text(),n=e.filter(function(t){return o==t.id})[0];if(u(this).is(".sub")){if(n.num<=1)return;n.num--,u(this).next().val(n.num)}else n.num++,u(this).prev().val(n.num);e=JSON.stringify(e),u.cookie("product",e,{path:"/",expires:10}),u(this).parent().parent().next().text("￥"+n.num*n.price),i(),p()}),u(".product-tr").on("blur",".cart-input",function(t){var e=u.cookie("product");e=JSON.parse(e);var o=u(this).parents(".product-info"),n=o.next(".pro-id").text(),r=e.filter(function(t){return n==t.id})[0],c=u(this).val();/^[1-9]\d*$/.test(c)?(r.num=c,e=JSON.stringify(e),u.cookie("product",e,{path:"/",expires:10}),o.find(".tr-count").text("￥"+r.num*r.price),i(),p()):u(this).val(r.num)}),u(".all-check").click(function(t){(function(){var t=u(this).prop("checked");u(".single-check").prop("checked",t)}).call(this),i(),p()}).trigger("click"),u(".single-check").click(function(t){for(var e=u(".single-check"),o=0,n=0;n<e.length;n++)u(e[n]).prop("checked")&&o++;o==e.length?u(".all-check").prop("checked",!0):u(".all-check").prop("checked",!1),i(),p()})})})});